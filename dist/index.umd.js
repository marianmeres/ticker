!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ticker={})}(this,(function(e){"use strict";const t=e=>"function"==typeof e,n=(e,n="")=>{if(!t(e))throw new TypeError(`${n} Expecting function arg`.trim())},r=(e,r=null)=>{const o=e=>t(null==r?void 0:r.persist)&&r.persist(e);let i=(()=>{const e=new Map,t=t=>(e.has(t)||e.set(t,new Set),e.get(t)),n=(e,n)=>{if(!e)throw new TypeError("Expecting valid event name.");if("function"!=typeof n)throw new TypeError("Expecting valid callback function.");return t(e).add(n),()=>t(e).delete(n)};return{publish:(e,n)=>{t(e).forEach((e=>e(n)))},subscribe:n,subscribeOnce:(e,t)=>{const r=n(e,(e=>{t(e),r()}));return r},unsubscribe:(e,n)=>{t(e).delete(n)},unsubscribeAll:t=>e.delete(t)}})(),s=e;o(s);const a=()=>s,c=e=>{s!==e&&(s=e,o(s),i.publish("change",s))};return{set:c,get:a,update:e=>{n(e,"[update]"),c(e(a()))},subscribe:e=>(n(e,"[subscribe]"),e(s),i.subscribe("change",e))}};const o=(()=>{let e;return()=>{if(e)return e;if("undefined"!=typeof window&&"undefined"!=typeof document&&globalThis===window&&window.requestAnimationFrame&&window.cancelAnimationFrame)return e={requestAnimationFrame:window.requestAnimationFrame.bind(window),cancelAnimationFrame:window.cancelAnimationFrame.bind(window)},e;const t=new Map;let n=0;return e={requestAnimationFrame(e){const r=++n;return t.set(r,e),setTimeout((()=>{if(t.has(r)){const n=Date.now();e(n),t.delete(r)}}),1e3/60),r},cancelAnimationFrame(e){t.delete(e)}},e}})();function i(e,t){const{requestAnimationFrame:n,cancelAnimationFrame:r}=o(),i=performance.now();let s=n((function r(o){o-i>=t?e():s=n(r)}));return()=>r(s)}const s=()=>"undefined"!=typeof window?window.performance.now():Date.now(),a=e=>{if(e=parseInt(e,10),Number.isNaN(e)||e<=0)throw new TypeError("Invalid interval. Expecting positive non-zero number of milliseconds.");return e};function c(e=1e3,t=!1,n=null,o=!1){o&&"number"==typeof e&&e<1e3/60&&console.warn(["Smaller interval than 60Hz may not be accurate with RAF ticker.","Consider using `createTicker` instead of `createTickerRAF`."].join(" "));const c=o?1e3/60:0,u=o?i:setTimeout,l=r(0);let f=0;const d=t=>a("function"==typeof e?e(t,l.get()):e);let p=d(0),w=t,m=0;const b=()=>{const e=s();if(m||=e,l.set(Date.now()),!w)return;const t=s()-m,r=t?t-p:0,o=Math.max(c,d(p)-r);f=u(b,o),p=o,m=s(),((...e)=>{"function"==typeof n&&n.apply(null,e)})({_start:e,_duration:t,_offset:r,_nextInterval:o})},y={subscribe:l.subscribe,start:()=>(w=!0,!f&&b(),y),stop:()=>(w=!1,l.set(0),f&&("function"==typeof f?f():clearTimeout(f),f=0),m=0,p=0,y),toggle:()=>(w?y.stop():y.start(),y),isStarted:()=>w,setInterval:t=>(e=t,y),getInterval:()=>d(0)};return t&&y.start(),y}e.createDelayedWorkerTicker=(e,t=1e3,n=!1)=>{const o=(e={})=>({started:0,finished:0,error:null,result:null,...e||{}});let i=0;const s=r(o()),c=e=>a("function"==typeof t?t(e,s.get()):t);let u=0,l=n;const f=async()=>{if(!l)return;const t=Date.now();try{const n=s.get();s.set(o({started:t}));const r=await e(n);l&&s.set(o({started:t,finished:Date.now(),error:null,result:r}))}catch(e){l&&s.set(o({started:t,finished:Date.now(),error:e}))}if(l){u&&clearTimeout(u);const e=c(i||0);u=setTimeout(f,e),i=e}},d={subscribe:s.subscribe,start:()=>(l=!0,!u&&f(),d),stop:()=>(u&&(clearTimeout(u),u=0),l=!1,i=0,d),toggle:()=>(l?d.stop():d.start(),d),isStarted:()=>l,setInterval:e=>(t=e,d),getInterval:()=>c(0)};return n&&d.start(),d},e.createTicker=function(e=1e3,t=!1,n=null){return c(e,t,n,!1)},e.createTickerRAF=(e=1e3,t=!1,n=null)=>c(e,t,n,!0)}));
