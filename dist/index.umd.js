!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ticker={})}(this,(function(e){"use strict";const t=e=>"function"==typeof e,n=(e,n="")=>{if(!t(e))throw new TypeError(`${n} Expecting function arg`.trim())},r=(e,r=null)=>{const s=e=>t(r?.persist)&&r.persist(e);let o=(()=>{const e=new Map,t=t=>(e.has(t)||e.set(t,new Set),e.get(t)),n=(e,n)=>{if("function"!=typeof n)throw new TypeError("Expecting callback function as second argument");return t(e).add(n),()=>t(e).delete(n)};return{publish:(e,n)=>{t(e).forEach((e=>e(n)))},subscribe:n,subscribeOnce:(e,t)=>{const r=n(e,(e=>{t(e),r()}));return r},unsubscribeAll:t=>e.delete(t)}})(),i=e;s(i);const c=()=>i,u=e=>{i!==e&&(i=e,s(i),o.publish("change",i))};return{set:u,get:c,update:e=>{n(e,"[update]"),u(e(c()))},subscribe:e=>(n(e,"[subscribe]"),e(i),o.subscribe("change",e))}},s=()=>"undefined"!=typeof window?window.performance.now():Date.now(),o=e=>{if(e=parseInt(e,10),Number.isNaN(e)||e<=0)throw new TypeError("Invalid interval. Expecting positive non-zero number of milliseconds.");return e};e.createDelayedWorkerTicker=(e,t=1e3,n=!1)=>{const s=(e={})=>({started:0,finished:0,error:null,result:null,...e||{}});let i=0;const c=r(s());let u=0,a=n;const l=async()=>{if(!a)return;const n=Date.now();try{const t=c.get();c.set(s({started:n}));const r=await e(t);a&&c.set(s({started:n,finished:Date.now(),error:null,result:r}))}catch(e){a&&c.set(s({started:n,finished:Date.now(),error:e}))}if(a){u&&clearTimeout(u);const e=(r=i||0,o("function"==typeof t?t(r,c.get()):t));u=setTimeout(l,e),i=e}var r},f={subscribe:c.subscribe,start:()=>(a=!0,!u&&l(),f),stop:()=>(u&&(clearTimeout(u),u=0),a=!1,i=0,f),setInterval:e=>(t=e,f)};return n&&f.start(),f},e.createTicker=(e=1e3,t=!1,n=null)=>{const i=r(0);let c=0;const u=t=>o("function"==typeof e?e(t,i.get()):e);let a=u(0),l=0;const f=()=>{const e=s();l||=e,i.set(Date.now());const t=s()-l,r=t?t-a:0,o=Math.max(0,u(a)-r);c=setTimeout(f,o),a=o,l=s(),((...e)=>{"function"==typeof n&&n.apply(null,e)})({_start:e,_duration:t,_offset:r,_nextInterval:o})},p={subscribe:i.subscribe,start:()=>(!c&&f(),p),stop:()=>(i.set(0),c&&(clearTimeout(c),c=0),l=0,a=0,p),setInterval:t=>(e=t,p)};return t&&p.start(),p}}));
