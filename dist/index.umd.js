!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ticker={})}(this,(function(e){"use strict";const t=e=>"function"==typeof e,n=(e,n="")=>{if(!t(e))throw new TypeError(`${n} Expecting function arg`.trim())},s=(e=void 0,s=null)=>{const r=e=>t(s?.persist)&&s.persist(e);let o=(()=>{const e=new Map,t=t=>(e.has(t)||e.set(t,new Set),e.get(t)),n=(e,n)=>{if("function"!=typeof n)throw new TypeError("Expecting callback function as second argument");return t(e).add(n),()=>t(e).delete(n)};return{publish:(e,n)=>{t(e).forEach((e=>e(n)))},subscribe:n,subscribeOnce:(e,t)=>{const s=n(e,(e=>{t(e),s()}));return s},unsubscribeAll:t=>e.delete(t)}})(),i=e;r(i);const c=()=>i,a=e=>{i!==e&&(i=e,r(i),o.publish("change",i))};return{set:a,get:c,update:e=>{n(e,"[update]"),a(e(c()))},subscribe:e=>(n(e,"[subscribe]"),e(i),o.subscribe("change",e))}},r=()=>"undefined"!=typeof window?window.performance.now():Date.now(),o=e=>{if(e=parseInt(e,10),Number.isNaN(e)||e<=0)throw new TypeError("Invalid interval. Expecting positive non-zero number of milliseconds.");return e};e.createDelayedWorkerTicker=(e,t=1e3,n=!1)=>{const r=e=>t=o(e),i=(e={})=>({started:0,finished:0,error:null,result:null,...e||{}});r(t);const c=s(i());let a=0,u=n;const l=async()=>{if(!u)return;const n=Date.now();try{const t=c.get();c.set(i({started:n}));const s=await e(t);u&&c.set(i({started:n,finished:Date.now(),result:s}))}catch(e){u&&c.set(i({started:n,finished:Date.now(),error:e}))}u&&(a&&clearTimeout(a),a=setTimeout(l,t))},f={subscribe:c.subscribe,start:()=>(u=!0,!a&&l(),f),stop:()=>(a&&(clearTimeout(a),a=0),u=!1,f),setInterval:e=>(r(e),f)};return n&&f.start(),f},e.createTicker=(e=1e3,t=!1,n=null)=>{const i=t=>e=o(t);i(e);const c=s(0);let a=0,u=0;const l=()=>{const t=r();u||=t,c.set(Date.now());const s=r()-u,o=s?s-e:0,i=Math.max(0,e-o);a=setTimeout(l,i),u=r(),((...e)=>{"function"==typeof n&&n.apply(null,e)})({_start:t,_duration:s,_offset:o,_nextInterval:i})},f={subscribe:c.subscribe,start:()=>(!a&&l(),f),stop:()=>(c.set(0),a&&(clearTimeout(a),a=0),u=0,f),setInterval:e=>(i(e),f)};return t&&f.start(),f}}));
