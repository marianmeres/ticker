"use strict";const e=e=>"function"==typeof e,t=(t,r="")=>{if(!e(t))throw new TypeError(`${r} Expecting function arg`.trim())},r=(r=void 0,s=null)=>{const n=t=>e(s?.persist)&&s.persist(t);let o=(()=>{const e=new Map,t=t=>(e.has(t)||e.set(t,new Set),e.get(t)),r=(e,r)=>{if("function"!=typeof r)throw new TypeError("Expecting callback function as second argument");return t(e).add(r),()=>t(e).delete(r)};return{publish:(e,r={})=>{t(e).forEach((e=>e(r)))},subscribe:r,subscribeOnce:(e,t)=>{const s=r(e,(e=>{t(e),s()}));return s},unsubscribeAll:t=>e.delete(t)}})(),i=r;n(i);const c=()=>i,a=e=>{i!==e&&(i=e,n(i),o.publish("change",i))};return{set:a,get:c,update:e=>{t(e,"[update]"),a(e(c()))},subscribe:e=>(t(e,"[subscribe]"),e(i),o.subscribe("change",e))}},s=()=>"undefined"!=typeof window?window.performance.now():Date.now(),n=e=>{if(e=parseInt(e,10),Number.isNaN(e)||e<=0)throw new TypeError("Invalid interval. Expecting positive non-zero number of milliseconds.");return e};exports.createDelayedWorkerTicker=(e,t=1e3,o=!1)=>{const i=e=>t=n(e),c=(e={})=>({started:0,finished:0,error:null,result:null,...e||{}});i(t);const a=r(c());let u=0,l=o;const p=async()=>{if(!l)return;const r=s();let n;try{const t=a.get();a.set(c({started:r})),n=await e(t),l&&a.set(c({started:r,finished:s(),result:n}))}catch(e){l&&a.set(c({started:r,finished:s(),error:e}))}l&&(u&&clearTimeout(u),u=setTimeout(p,t))},b={subscribe:a.subscribe,start:()=>(l=!0,!u&&p(),b),stop:()=>(u&&(clearTimeout(u),u=0),l=!1,b),setInterval:e=>(i(e),b)};return o&&b.start(),b},exports.createTicker=(e=1e3,t=!1,o=null)=>{const i=t=>e=n(t);i(e);const c=r(0);let a=0,u=0;const l=()=>{const t=s();u||=t,c.set(Date.now());const r=s()-u,n=r?r-e:0,i=Math.max(0,e-n);a=setTimeout(l,i),u=s(),((...e)=>{"function"==typeof o&&o.apply(null,e)})({_start:t,_duration:r,_offset:n,_nextInterval:i})},p={subscribe:c.subscribe,start:()=>(!a&&l(),p),stop:()=>(c.set(0),a&&(clearTimeout(a),a=0),u=0,p),setInterval:e=>(i(e),p)};return t&&p.start(),p};
