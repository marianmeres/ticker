"use strict";const t=t=>"function"==typeof t,e=(e,r="")=>{if(!t(e))throw new TypeError(`${r} Expecting function arg`.trim())},r=(r,n=null)=>{const s=e=>t(n?.persist)&&n.persist(e);let o=(()=>{const t=new Map,e=e=>(t.has(e)||t.set(e,new Set),t.get(e)),r=(t,r)=>{if("function"!=typeof r)throw new TypeError("Expecting callback function as second argument");return e(t).add(r),()=>e(t).delete(r)};return{publish:(t,r)=>{e(t).forEach((t=>t(r)))},subscribe:r,subscribeOnce:(t,e)=>{const n=r(t,(t=>{e(t),n()}));return n},unsubscribeAll:e=>t.delete(e)}})(),c=r;s(c);const i=()=>c,a=t=>{c!==t&&(c=t,s(c),o.publish("change",c))};return{set:a,get:i,update:t=>{e(t,"[update]"),a(t(i()))},subscribe:t=>(e(t,"[subscribe]"),t(c),o.subscribe("change",t))}},n=()=>"undefined"!=typeof window?window.performance.now():Date.now(),s=t=>{if(t=parseInt(t,10),Number.isNaN(t)||t<=0)throw new TypeError("Invalid interval. Expecting positive non-zero number of milliseconds.");return t};exports.createDelayedWorkerTicker=(t,e=1e3,n=!1)=>{const o=(t={})=>({started:0,finished:0,error:null,result:null,...t||{}});let c=0;const i=r(o());let a=0,u=n;const l=async()=>{if(!u)return;const r=Date.now();try{const e=i.get();i.set(o({started:r}));const n=await t(e);u&&i.set(o({started:r,finished:Date.now(),error:null,result:n}))}catch(t){u&&i.set(o({started:r,finished:Date.now(),error:t}))}if(u){a&&clearTimeout(a);const t=(n=c||0,s("function"==typeof e?e(n,i.get()):e));a=setTimeout(l,t),c=t}var n},p={subscribe:i.subscribe,start:()=>(u=!0,!a&&l(),p),stop:()=>(a&&(clearTimeout(a),a=0),u=!1,c=0,p),setInterval:t=>(e=t,p)};return n&&p.start(),p},exports.createTicker=(t=1e3,e=!1,o=null)=>{const c=r(0);let i=0;const a=e=>s("function"==typeof t?t(e,c.get()):t);let u=a(0),l=e,p=0;const f=()=>{const t=n();if(p||=t,c.set(Date.now()),!l)return;const e=n()-p,r=e?e-u:0,s=Math.max(0,a(u)-r);i=setTimeout(f,s),u=s,p=n(),((...t)=>{"function"==typeof o&&o.apply(null,t)})({_start:t,_duration:e,_offset:r,_nextInterval:s})},b={subscribe:c.subscribe,start:()=>(l=!0,!i&&f(),b),stop:()=>(l=!1,c.set(0),i&&(clearTimeout(i),i=0),p=0,u=0,b),toggle:()=>(l?b.stop():b.start(),b),setInterval:e=>(t=e,b)};return e&&b.start(),b};
